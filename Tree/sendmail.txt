<style>
  /* Modal overlay */
  #modal_view {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: none; /* Ẩn mặc định */
    z-index: 9999;
    overflow-y: auto; /* Scroll nếu nội dung dài */
  }

  /* Nội dung modal */
  #modal_body {
    background: #fff;
    min-height: 100%;
    width: 100%;
    box-sizing: border-box;
    padding: 60px 20px 20px; /* Xích nội dung để tránh đè nút close */
  }

  /* Nút đóng */
  #btn_close_modal {
    position: fixed;
    top: 10px;
    right: 10px;
    background: transparent;
    border: none;
    font-size: 22px;
    padding: 6px;
    cursor: pointer;
  }
  #btn_close_modal:hover {
    background: rgba(0,0,0,0.1);
    border-radius: 6px;
  }
</style>
<b>Nhập email : <b>
<br />
<input type="text" id="mail" style="width: 600px;" />
<br />
<b>Nhập subject : <b>
<br />
<input type="text" id="subject" style="width: 600px;" />
<br />
<b>Nhập nội dung : <b>
<br />
<textarea id="message" cols="200" rows="20"></textarea>
<br />
<input id="isHTML" type="checkbox" /><b style="color:blue">Is body mail HTML</b>&nbsp;&nbsp;&nbsp;&nbsp;<button onclick="showModalView()">Xem trước HTML</button>
<br />
<input type="file" id="files" multiple />
<br /><br />
<button onclick="sendmail()"><b style="color:red">SEND MAIL</b></button>
<div id="modal_view">
  <button id="btn_close_modal" onclick="closeModalView()">❌</button>
  <div id="modal_body">
    <div id="modal_data"></div>
  </div>
</div>

<script>
  function showModalView() {
    // Gán nội dung trước
    document.getElementById("modal_data").innerHTML =
        document.getElementById("message").value;

    // Rồi mới bật modal
    document.getElementById("modal_view").style.display = "block";
  }

  function closeModalView() {
    document.getElementById("modal_view").style.display = "none";
  }
</script>
<script>
if (localStorage.getItem("data_subject") != null)
{
   document.getElementById("subject").value = localStorage.getItem("data_subject");
}

if (localStorage.getItem("data_message") != null)
{
   document.getElementById("message").value = localStorage.getItem("data_message");
}

if (localStorage.getItem("data_isHTML") != null)
{
   document.getElementById("isHTML").checked = true;
}

async function sendmail()
{
var mail = document.getElementById("mail").value;
var subject = document.getElementById("subject").value;
var message = document.getElementById("message").value;
var isHTML = document.getElementById("isHTML").checked;
localStorage.removeItem("data_subject");
localStorage.removeItem("data_message");
localStorage.removeItem("data_isHTML");

var input = document.getElementById('files');
var files = input.files;

var formData = new FormData();
formData.append("txtEmail", mail);
formData.append("txtMessage", message);
formData.append("txtSubject", subject);
formData.append("isBodyHTML", "" + isHTML);

for (var i = 0; i < files.length; i++) {
        formData.append('files', files[i]);
}

fetch("/Home/SendMailSave1", {
method: "POST",
body: formData
})
.then(res => res.json())
.then(data => {
if (data.result == true)
{
alert("Đã gửi mail thành công.");
}
});
}
</script>
