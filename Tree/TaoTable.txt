 <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #aaa;
      padding: 8px;
      text-align: left;
      word-break: break-word;
    }

    th {
      background-color: #f2f2f2;
    }

    input[type="text"] {
      width: 200px;
      margin-bottom: 5px;
    }

    label {
      display: inline-block;
      margin: 5px 0;
    }

    #searchFormContainer {
      margin-top: 20px;
    }

    button {
      margin-top: 10px;
      padding: 6px 12px;
    }
  </style>
</head>
<body>

  <div id="searchFormContainer"></div>
  <div id="tableContainer"></div>

  <script>
    // Giả sử localStorage có sẵn tableX, nếu không thì demo mẫu
    if (!localStorage.getItem("tableX")) {
      localStorage.setItem("tableX",
        "Tên***30\tTuổi***20\tĐịa chỉ***45\n" +
        "Nam\t25\tHà Nội\n" +
        "Lan\t30\tTP HCM\n" +
        "Tú\t28\tĐà Nẵng\n" +
        "Mai\t25\tHải Phòng"
      );
    }

    function generateTableWithSearch() {
      const raw = localStorage.getItem("tableX");
      localStorage.removeItem("tableX");
      if (!raw || raw.trim() === "") return;

      const rows = raw.trim().split("\n");
      const headers = rows[0].split("\t").map(col => col.split("***"));
      const data = rows.slice(1).map(row => row.split("\t"));

      // Table HTML
      const table = document.createElement("table");
      table.id = "dynamicTable";

      const thead = document.createElement("thead");
      const trHead = document.createElement("tr");

      const sttTh = document.createElement("th");
      sttTh.textContent = "STT";
      sttTh.style.width = "5%";
      trHead.appendChild(sttTh);

      headers.forEach(([name, width]) => {
        const th = document.createElement("th");
        th.textContent = name;
        th.style.width = width + "%";
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      data.forEach((row, idx) => {
        const tr = document.createElement("tr");

        const sttTd = document.createElement("td");
        sttTd.textContent = idx + 1;
        tr.appendChild(sttTd);

        row.forEach(text => {
          const td = document.createElement("td");
          td.textContent = text;
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      // Render table
      const container = document.getElementById("tableContainer");
      container.innerHTML = "";
      container.appendChild(table);

      // Search form
      const form = document.createElement("div");
      form.id = "searchForm";

      headers.forEach(([name], i) => {
        const label = document.createElement("label");
        label.innerHTML = `${name}: <input type="text" id="txtCot${i + 1}">`;
        form.appendChild(label);
        form.appendChild(document.createElement("br"));
      });

      // AND/OR
      const cond = document.createElement("label");
      cond.innerHTML = `Điều kiện:
        <input type="radio" name="cond" value="AND" checked>AND
        <input type="radio" name="cond" value="OR">OR`;
      form.appendChild(cond);
      form.appendChild(document.createElement("br"));

      // Button
      const btn = document.createElement("button");
      btn.textContent = "Tìm kiếm";
      btn.onclick = () => {
        const values = headers.map((_, i) =>
          document.getElementById("txtCot" + (i + 1)).value.trim().toLowerCase()
        );
        const condition = document.querySelector("input[name='cond']:checked").value;
        const trs = table.querySelectorAll("tbody tr");

        trs.forEach(tr => {
          const tds = Array.from(tr.querySelectorAll("td")).slice(1); // Bỏ STT
          const checks = values.map((val, i) =>
            val === "" || tds[i].textContent.toLowerCase().includes(val)
          );
          const show = condition === "AND"
            ? checks.every(Boolean)
            : checks.some(Boolean);
          tr.style.display = show ? "" : "none";
        });
      };
      form.appendChild(btn);

      const formContainer = document.getElementById("searchFormContainer");
      formContainer.innerHTML = "";
      formContainer.appendChild(form);
    }

    // Init
    generateTableWithSearch();
  </script>
