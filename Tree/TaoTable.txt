<script>
function generateTableFromText(inputText) {
  const rows = inputText.trim().split(/\r?\n/);
  if (rows.length === 0) return "";

  let tableHTML = `<table border="1" style="border-collapse: collapse; width: 100%; table-layout: fixed;">\n`;

  rows.forEach((row, rowIndex) => {
    const cols = row.split("\t");
    tableHTML += "  <tr>\n";

    cols.forEach(col => {
      const cellStyle = "word-wrap: break-word; white-space: normal; padding: 4px;";
      if (rowIndex === 0) {
        const [headerText, widthPercent] = col.split("***");
        const width = parseInt(widthPercent) || 0;
        tableHTML += `    <th style="width: ${width}%; text-align: left; ${cellStyle}">${escapeHTML(headerText)}</th>\n`;
      } else {
        tableHTML += `    <td style="${cellStyle}">${escapeHTML(col)}</td>\n`;
      }
    });

    tableHTML += "  </tr>\n";
  });

  tableHTML += "</table>";
  return tableHTML;
}

// Hàm để escape HTML tránh XSS
function escapeHTML(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

const input = localStorage.getItem("tableX");
localStorage.removeItem("tableX");
const tableHTML = generateTableFromText(input);
document.body.innerHTML = tableHTML;
</script>
