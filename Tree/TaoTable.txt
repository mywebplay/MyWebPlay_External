 <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: left;
      word-break: break-word;
      white-space: normal;
    }
    th {
      background: #eee;
    }
    input[type="text"] {
      width: 100%;
      max-width: 300px;
      padding: 5px;
      margin-bottom: 10px;
    }
  </style>
<input type="text" id="searchInput" placeholder="Tìm kiếm" onchange="renderTable()" />
  <table id="dataTable" border="1" style="width: 100%; margin-top: 10px;"></table>

  <script>
    function renderTable() {
      const rawData = localStorage.getItem("tableX");
      if (!rawData) return;

      const lines = rawData.trim().split("\n");
      if (lines.length < 2) return;

      const headers = lines[0].split("\t");
      const widths = headers.map(h => h.split("***")[1] || "auto");
      const titles = headers.map(h => h.split("***")[0]);
      const dataRows = lines.slice(1);

      const keyword = document.getElementById("searchInput").value.trim();
      const regex = keyword ? new RegExp(keyword, "i") : null;

      const table = document.getElementById("dataTable");
      table.innerHTML = "";

      // Header
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");

      const sttTh = document.createElement("th");
      sttTh.textContent = "STT";
      headerRow.appendChild(sttTh);

      titles.forEach((title, i) => {
        const th = document.createElement("th");
        th.textContent = title;
        th.style.width = widths[i] + "%";
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Body
      const tbody = document.createElement("tbody");
      let stt = 1;

      dataRows.forEach(row => {
        const cells = row.split("\t");

        // Lọc theo regex nếu có
        if (regex) {
          const combined = cells.join("\t").toLowerCase();
          if (!regex.test(combined)) return;
        }

        const tr = document.createElement("tr");

        const sttTd = document.createElement("td");
        sttTd.textContent = stt++;
        tr.appendChild(sttTd);

        cells.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
    }

    renderTable();
  </script>
