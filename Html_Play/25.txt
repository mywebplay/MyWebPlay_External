<script>
(function () {
    let path;

    try {
        if (window.top !== window.self) {
            // đang trong iframe
            path = window.top.location.pathname;
        } else {
            // không phải iframe
            path = window.location.pathname;
        }
    } catch (e) {
        // fallback nếu cross-origin
        path = window.location.pathname;
    }

    // chỉ chạy khi path = /trac-nghiem-index
    if (path !== '/trac-nghiem-index') return;

    if (document.getElementById("custom1633")) {
        document.getElementById("custom1633").style.display = "none";
    }

    (function () {
        const el = document.getElementById("custom737");
        if (!el) return;

        // Lưu HTML gốc vào localStorage (nếu chưa lưu trước đó)
        const originalHTML = el.innerHTML;
        localStorage.setItem("tracnghiem_layout", originalHTML);

        if (localStorage.getItem("tracnghiem_info") == null) {
            var data = {
                TongSoCau: document.getElementsByName("TongSoCau")[0].value,
                GioiHanCau: document.getElementsByName("GioiHanCau")[0].value,
                TimeLamBai: document.getElementsByName("TimeLamBai")[0].value,
                TenMon: document.getElementsByName("TenMon")[0].value,
                CauHoi: document.getElementsByName("CauHoi")[0].value,
                A: document.getElementsByName("A")[0].value,
                B: document.getElementsByName("B")[0].value,
                C: document.getElementsByName("C")[0].value,
                D: document.getElementsByName("D")[0].value,
                Dung: document.getElementsByName("Dung")[0].value,
                txtUserIP: document.getElementsByName("txtUserIP")[0].value,
                File_ND: ''
            };

            localStorage.setItem("tracnghiem_info", JSON.stringify(data));
        }

        // Ẩn phần tử gốc
        el.style.display = "none";

        // Tạo iframe mới
        const iframe = document.createElement("iframe");
        iframe.src = "/Cover/CustomerPagePlay?code=layout-tracnghiem";
        iframe.style.width = "100%";
        iframe.style.border = "none";
        iframe.style.height = "500px";

        // Tạo khối HTML bên dưới iframe
        const wrapper = document.createElement("div");
        wrapper.innerHTML = `
            <button onclick="hayquaX()">Xem kết quả</button>
            <br />
            <p style="color:deeppink">
                Lưu ý: kiểm tra thật kỹ toàn bộ bài làm trước khi xem kết quả!
            </p>
            <br />
        `;

        // ✅ Chỉ chèn nếu chưa có
        const existedIframe = document.querySelector('iframe[src*="layout-tracnghiem"]');
        if (!existedIframe) {
            el.parentNode.insertBefore(iframe, el.nextSibling);
            el.parentNode.insertBefore(wrapper, iframe.nextSibling);
        }
    })();

    function hayquaX() {
        document.getElementById("OKX").click();
    }

    localStorage.setItem(
        "time_tracnghiem",
        document.getElementById("custom747").innerText
            .replaceAll("Thời gian làm bài : ", "")
            .split("phút")[0]
            .trim()
    );
    document.getElementById("frameTN").style.display = "flex";
})();
</script>
